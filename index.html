<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Indian TTS Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.css"
    />
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
      :root {
        --bg-primary: #ffffff;
        --bg-secondary: #f8fafc;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --border-color: #e5e7eb;
        --input-bg: #ffffff;
        --card-bg: #ffffff;
        --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      }

      [data-theme="dark"] {
        --bg-primary: #111827;
        --bg-secondary: #1f2937;
        --text-primary: #f9fafb;
        --text-secondary: #d1d5db;
        --border-color: #374151;
        --input-bg: #374151;
        --card-bg: #1f2937;
        --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);
      }

      * {
        transition: background-color 0.2s ease, color 0.2s ease,
          border-color 0.2s ease;
      }

      body {
        background-color: var(--bg-primary);
        color: var(--text-primary);
      }

      .card {
        background-color: var(--card-bg);
        border-color: var(--border-color);
        box-shadow: var(--shadow);
      }

      .input-field {
        background-color: var(--input-bg);
        border-color: var(--border-color);
        color: var(--text-primary);
      }

      .input-field:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .text-secondary {
        color: var(--text-secondary);
      }

      .text-primary {
        color: var(--text-primary);
      }

      .theme-toggle {
        background-color: var(--input-bg);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
      }
      .loader {
        border: 2px solid #f3f4f6;
        border-top: 2px solid #6b7280;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .notification {
        transform: translateX(100%);
        transition: transform 0.3s ease-in-out;
      }
      .notification.show {
        transform: translateX(0);
      }
      input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        background: transparent;
        cursor: pointer;
      }
      input[type="range"]::-webkit-slider-track {
        background: #e5e7eb;
        height: 4px;
        border-radius: 2px;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        background: #6b7280;
        height: 16px;
        width: 16px;
        border-radius: 50%;
        cursor: pointer;
      }
      input[type="range"]::-moz-range-track {
        background: #e5e7eb;
        height: 4px;
        border-radius: 2px;
        border: none;
      }
      input[type="range"]::-moz-range-thumb {
        background: #6b7280;
        height: 16px;
        width: 16px;
        border-radius: 50%;
        cursor: pointer;
        border: none;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen py-8 px-4">
    <!-- Notification -->
    <div
      id="notification"
      class="notification fixed top-4 right-4 z-50 bg-white border border-gray-200 px-4 py-3 rounded-lg shadow-lg"
    >
      <div class="flex items-center space-x-2">
        <i
          id="notificationIcon"
          data-feather="check-circle"
          class="w-4 h-4 text-green-500"
        ></i>
        <span id="notificationText" class="text-sm text-gray-700"
          >Success!</span
        >
      </div>
    </div>

    <div class="max-w-2xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-8 relative">
        <button
          id="themeToggle"
          class="theme-toggle absolute top-0 right-0 p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
          title="Toggle theme"
        >
          <i id="themeIcon" data-feather="moon" class="w-5 h-5"></i>
        </button>
        <h1 class="text-3xl font-light mb-2 text-primary">Text to Speech</h1>
        <p class="text-sm text-secondary">
          Convert text to natural speech in Indian languages
        </p>
      </div>

      <!-- Main Card -->
      <div class="card rounded-lg border p-6 space-y-6">
        <!-- Token Input -->
        <div>
          <label
            class="flex items-center text-sm font-medium text-secondary mb-2"
          >
            <i data-feather="key" class="w-4 h-4 mr-2"></i>
            Google TTS Token
          </label>
          <div class="flex space-x-2">
            <input
              id="tokenInput"
              type="password"
              placeholder="Enter your token"
              class="flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-gray-500 focus:border-gray-500 input-field"
            />
            <button
              id="saveTokenBtn"
              class="px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors flex items-center space-x-1"
            >
              <i data-feather="save" class="w-4 h-4"></i>
              <span>Save</span>
            </button>
          </div>
          <p class="text-xs text-secondary mt-1 flex items-center">
            <i data-feather="info" class="w-3 h-3 mr-1"></i>
            Token is stored securely in your browser
          </p>
        </div>

        <!-- Text Input -->
        <div>
          <label
            class="flex items-center text-sm font-medium text-secondary mb-2"
          >
            <i data-feather="edit-3" class="w-4 h-4 mr-2"></i>
            Text to Speak
          </label>
          <textarea
            id="textInput"
            rows="4"
            placeholder="Enter the text you want to convert to speech..."
            class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-gray-500 focus:border-gray-500 resize-none input-field"
          ></textarea>
          <div class="flex justify-between text-xs text-secondary">
            <span id="charCount">0 characters</span>
            <span id="estimatedDuration">~0 seconds</span>
          </div>

          <!-- Text History -->
          <div class="mt-2">
            <label
              for="textHistory"
              class="block text-xs font-medium text-secondary mb-1"
            >
              <i data-feather="clock" class="w-3 h-3 inline mr-1"></i>
              Recent Texts
            </label>
            <select
              id="textHistory"
              class="w-full px-2 py-1 text-xs border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent input-field"
            >
              <option value="">Select from history...</option>
            </select>
          </div>
        </div>

        <!-- Language and Voice -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label
              class="flex items-center text-sm font-medium text-secondary mb-2"
            >
              <i data-feather="globe" class="w-4 h-4 mr-2"></i>
              Language
            </label>
            <select
              id="languageSelect"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-gray-500 focus:border-gray-500 input-field"
            >
              <option value="en-IN">English (India)</option>
              <option value="hi-IN">हिन्दी (भारत)</option>
            </select>
          </div>
          <div>
            <label
              class="flex items-center text-sm font-medium text-secondary mb-2"
            >
              <i data-feather="mic" class="w-4 h-4 mr-2"></i>
              Voice
            </label>
            <select
              id="voiceSelect"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-gray-500 focus:border-gray-500 input-field"
            ></select>
          </div>
        </div>

        <!-- Audio Controls -->
        <div>
          <h3 class="flex items-center text-sm font-medium text-secondary mb-4">
            <i data-feather="sliders" class="w-4 h-4 mr-2"></i>
            Audio Settings
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label
                class="flex items-center justify-between text-sm text-secondary mb-2"
              >
                <span>Speed</span>
                <span id="speedValue" class="font-medium">1.0</span>
              </label>
              <input
                id="speedSlider"
                type="range"
                min="0.5"
                max="2"
                step="0.1"
                value="1"
                class="w-full"
              />
            </div>
            <div>
              <label
                class="flex items-center justify-between text-sm text-secondary mb-2"
              >
                <span>Pitch</span>
                <span id="pitchValue" class="font-medium">0</span>
              </label>
              <input
                id="pitchSlider"
                type="range"
                min="-10"
                max="10"
                step="1"
                value="0"
                class="w-full"
              />
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-3 pt-4">
          <button
            id="playBtn"
            class="flex-1 flex items-center justify-center space-x-2 px-4 py-3 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i id="playIcon" data-feather="play" class="w-4 h-4"></i>
            <span id="playText">Play</span>
            <div id="playLoader" class="loader hidden"></div>
          </button>
          <button
            id="downloadBtn"
            class="flex-1 flex items-center justify-center space-x-2 px-4 py-3 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i id="downloadIcon" data-feather="download" class="w-4 h-4"></i>
            <span id="downloadText">Download</span>
            <div id="downloadLoader" class="loader hidden"></div>
          </button>
        </div>
      </div>
    </div>

    <script>
      // Initialize Feather icons
      feather.replace();

      // Theme management
      function initTheme() {
        const savedTheme = localStorage.getItem("theme");
        const systemPrefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        const theme = savedTheme || (systemPrefersDark ? "dark" : "light");

        setTheme(theme);

        // Listen for system theme changes
        window
          .matchMedia("(prefers-color-scheme: dark)")
          .addEventListener("change", (e) => {
            if (!localStorage.getItem("theme")) {
              setTheme(e.matches ? "dark" : "light");
            }
          });
      }

      function setTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        const themeIcon = document.getElementById("themeIcon");

        if (theme === "dark") {
          themeIcon.setAttribute("data-feather", "sun");
        } else {
          themeIcon.setAttribute("data-feather", "moon");
        }

        feather.replace();
      }

      function toggleTheme() {
        const currentTheme =
          document.documentElement.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";

        setTheme(newTheme);
        localStorage.setItem("theme", newTheme);
      }

      // Theme toggle event listener
      document
        .getElementById("themeToggle")
        .addEventListener("click", toggleTheme);

      // Initialize theme
      initTheme();

      // Utility functions
      function showNotification(message, type = "success", duration = 3000) {
        const notification = document.getElementById("notification");
        const icon = document.getElementById("notificationIcon");
        const text = document.getElementById("notificationText");

        // Set notification style and icon based on type
        const styles = {
          success: {
            bg: "bg-white border-green-200",
            iconColor: "text-green-500",
            icon: "check-circle",
          },
          error: {
            bg: "bg-white border-red-200",
            iconColor: "text-red-500",
            icon: "x-circle",
          },
          warning: {
            bg: "bg-white border-yellow-200",
            iconColor: "text-yellow-500",
            icon: "alert-triangle",
          },
          info: {
            bg: "bg-white border-blue-200",
            iconColor: "text-blue-500",
            icon: "info",
          },
        };

        const style = styles[type] || styles.success;
        notification.className = `notification fixed top-4 right-4 z-50 ${style.bg} px-4 py-3 rounded-lg shadow-lg border`;
        icon.className = `w-4 h-4 ${style.iconColor}`;
        icon.setAttribute("data-feather", style.icon);
        text.textContent = message;

        feather.replace();
        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, duration);
      }

      function setButtonLoading(buttonId, isLoading) {
        const button = document.getElementById(buttonId);
        const icon = document.getElementById(buttonId.replace("Btn", "Icon"));
        const text = document.getElementById(buttonId.replace("Btn", "Text"));
        const loader = document.getElementById(
          buttonId.replace("Btn", "Loader")
        );

        if (isLoading) {
          button.disabled = true;
          icon.classList.add("hidden");
          text.classList.add("hidden");
          loader.classList.remove("hidden");
        } else {
          button.disabled = false;
          icon.classList.remove("hidden");
          text.classList.remove("hidden");
          loader.classList.add("hidden");
        }
      }

      // Voice data
      const voices = [
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp-HD-D",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp-HD-F",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp-HD-O",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Achernar",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Achird",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Algenib",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Algieba",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Alnilam",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Aoede",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Autonoe",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Callirrhoe",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Charon",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Despina",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Enceladus",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Erinome",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Fenrir",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Gacrux",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Iapetus",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Kore",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Laomedeia",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Leda",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Orus",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Puck",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Pulcherrima",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Rasalgethi",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Sadachbia",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Sadaltager",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Schedar",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Sulafat",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Umbriel",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Vindemiatrix",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Zephyr",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Chirp3-HD-Zubenelgenubi",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Neural2-A",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Neural2-B",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Neural2-C",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Neural2-D",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Standard-A",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Standard-B",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Standard-C",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Standard-D",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Standard-E",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Standard-F",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Wavenet-A",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Wavenet-B",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Wavenet-C",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Wavenet-D",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Wavenet-E",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["en-IN"],
          name: "en-IN-Wavenet-F",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Achernar",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Achird",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Algenib",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Algieba",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Alnilam",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Aoede",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Autonoe",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Callirrhoe",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Charon",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Despina",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Enceladus",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Erinome",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Fenrir",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Gacrux",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Iapetus",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Kore",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Laomedeia",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Leda",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Orus",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Puck",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Pulcherrima",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Rasalgethi",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Sadachbia",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Sadaltager",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Schedar",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Sulafat",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Umbriel",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Vindemiatrix",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Zephyr",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Chirp3-HD-Zubenelgenubi",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Neural2-A",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Neural2-B",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Neural2-C",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Neural2-D",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Standard-A",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Standard-B",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Standard-C",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Standard-D",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Standard-E",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Standard-F",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Wavenet-A",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Wavenet-B",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Wavenet-C",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Wavenet-D",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Wavenet-E",
          ssmlGender: "FEMALE",
          naturalSampleRateHertz: 24000,
        },
        {
          languageCodes: ["hi-IN"],
          name: "hi-IN-Wavenet-F",
          ssmlGender: "MALE",
          naturalSampleRateHertz: 24000,
        },
      ];

      // DOM elements
      const tokenInput = document.getElementById("tokenInput");
      const languageSelect = document.getElementById("languageSelect");
      const voiceSelect = document.getElementById("voiceSelect");
      const speedSlider = document.getElementById("speedSlider");
      const pitchSlider = document.getElementById("pitchSlider");
      const speedValue = document.getElementById("speedValue");
      const pitchValue = document.getElementById("pitchValue");

      // Load saved token
      const savedToken = localStorage.getItem("tts_token");
      if (savedToken) {
        tokenInput.value = savedToken;
        showNotification("Token loaded", "success", 2000);
      }

      // Text statistics
      function updateTextStats() {
        const text = textArea.value;
        const charCount = text.length;
        const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;

        // Estimate speech duration (average 150-200 words per minute)
        const wordsPerMinute = 175;
        const estimatedMinutes = wordCount / wordsPerMinute;
        const estimatedSeconds = Math.round(estimatedMinutes * 60);

        document.getElementById(
          "charCount"
        ).textContent = `${charCount} characters`;

        if (estimatedSeconds < 60) {
          document.getElementById(
            "estimatedDuration"
          ).textContent = `~${estimatedSeconds} seconds`;
        } else {
          const minutes = Math.floor(estimatedSeconds / 60);
          const seconds = estimatedSeconds % 60;
          document.getElementById(
            "estimatedDuration"
          ).textContent = `~${minutes}m ${seconds}s`;
        }
      }

      // Text history management
      function saveTextToHistory(text) {
        if (!text.trim()) return;

        let history = JSON.parse(
          localStorage.getItem("tts_text_history") || "[]"
        );

        // Remove if already exists to avoid duplicates
        history = history.filter((item) => item.text !== text);

        // Add to beginning with timestamp
        history.unshift({
          text: text,
          timestamp: Date.now(),
          preview: text.length > 50 ? text.substring(0, 50) + "..." : text,
        });

        // Keep only last 20 items
        history = history.slice(0, 20);

        localStorage.setItem("tts_text_history", JSON.stringify(history));
        loadTextHistory();
      }

      function loadTextHistory() {
        const history = JSON.parse(
          localStorage.getItem("tts_text_history") || "[]"
        );
        const select = document.getElementById("textHistory");

        // Clear existing options except the first one
        select.innerHTML = '<option value="">Select from history...</option>';

        history.forEach((item, index) => {
          const option = document.createElement("option");
          option.value = item.text;
          option.textContent = `${item.preview}`;
          select.appendChild(option);
        });
      }

      function clearTextHistory() {
        localStorage.removeItem("tts_text_history");
        loadTextHistory();
      }

      // Voice settings management
      function saveVoiceSettings(language) {
        const settings = {
          voice: voiceSelect.value,
          speed: speedSlider.value,
          pitch: pitchSlider.value,
        };
        localStorage.setItem(
          `voice_settings_${language}`,
          JSON.stringify(settings)
        );
      }

      function loadVoiceSettings(language) {
        const saved = localStorage.getItem(`voice_settings_${language}`);
        if (saved) {
          try {
            const settings = JSON.parse(saved);
            if (
              settings.voice &&
              voiceSelect.querySelector(`option[value="${settings.voice}"]`)
            ) {
              voiceSelect.value = settings.voice;
            }
            if (settings.speed) {
              speedSlider.value = settings.speed;
              speedValue.textContent = settings.speed;
            }
            if (settings.pitch) {
              pitchSlider.value = settings.pitch;
              pitchValue.textContent = settings.pitch;
            }
          } catch (e) {
            console.error("Error loading voice settings:", e);
          }
        }
      }

      // Event listeners
      document.getElementById("saveTokenBtn").addEventListener("click", () => {
        const token = tokenInput.value.trim();
        if (!token) {
          showNotification("Please enter a valid token", "error");
          return;
        }
        localStorage.setItem("tts_token", token);
        showNotification("Token saved successfully", "success");
      });

      // Update slider values and save settings
      speedSlider.addEventListener("input", () => {
        speedValue.textContent = speedSlider.value;
        saveVoiceSettings(languageSelect.value);
      });

      pitchSlider.addEventListener("input", () => {
        pitchValue.textContent = pitchSlider.value;
        saveVoiceSettings(languageSelect.value);
      });

      // Save voice selection when changed
      voiceSelect.addEventListener("change", () => {
        saveVoiceSettings(languageSelect.value);
      });

      // Get text area element
      const textArea = document.getElementById("textInput");

      // Update text statistics in real-time
      textArea.addEventListener("input", updateTextStats);

      // Text history event listener
      document.getElementById("textHistory").addEventListener("change", (e) => {
        if (e.target.value) {
          textArea.value = e.target.value;
          updateTextStats();
          e.target.value = ""; // Reset selection
        }
      });

      // Check for token in URL query parameters
      function checkTokenFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const tokenFromURL = urlParams.get("token");

        if (tokenFromURL) {
          // Save token to localStorage
          localStorage.setItem("tts_token", tokenFromURL);

          // Update the token input field
          const tokenInput = document.getElementById("tokenInput");
          tokenInput.value = tokenFromURL;

          // Show success notification
          showNotification(
            "Token loaded from URL and saved successfully",
            "success",
            3000
          );

          // Remove token from URL for security (optional)
          const newURL = new URL(window.location);
          newURL.searchParams.delete("token");
          window.history.replaceState(
            {},
            document.title,
            newURL.pathname + newURL.search
          );
        }
      }

      // Initialize components
      checkTokenFromURL();
      updateTextStats();
      loadTextHistory();

      // Populate voices
      function populateVoices(lang) {
        voiceSelect.innerHTML = "";
        voices
          .filter((v) => v.languageCodes.includes(lang))
          .forEach((v) => {
            const opt = document.createElement("option");
            opt.value = v.name;
            opt.textContent = `${v.name} (${v.ssmlGender})`;
            voiceSelect.appendChild(opt);
          });
      }

      languageSelect.addEventListener("change", () => {
        // Save current settings before switching
        const currentLang = languageSelect.dataset.currentLang;
        if (currentLang) {
          saveVoiceSettings(currentLang);
        }

        populateVoices(languageSelect.value);
        loadVoiceSettings(languageSelect.value);

        // Update current language tracker
        languageSelect.dataset.currentLang = languageSelect.value;
      });

      populateVoices(languageSelect.value);

      // Synthesis function with improved audio handling
      async function synthesize() {
        const token = localStorage.getItem("tts_token");
        if (!token) {
          showNotification("Please enter and save a token first", "warning");
          return null;
        }

        const text = document.getElementById("textInput").value.trim();
        if (!text) {
          showNotification("Please enter some text", "warning");
          return null;
        }

        const voice = voiceSelect.value;
        if (!voice) {
          showNotification("Please select a voice", "warning");
          return null;
        }

        // Save text to history
        saveTextToHistory(text);

        const lang = languageSelect.value;
        const speed = parseFloat(speedSlider.value);
        const pitch = parseFloat(pitchSlider.value);

        const url = `https://cxl-services.appspot.com/proxy?url=https://texttospeech.googleapis.com/v1beta1/text:synthesize&token=${token}`;

        try {
          const res = await fetch(url, {
            method: "POST",
            headers: { "content-type": "application/json" },
            body: JSON.stringify({
              input: { text },
              voice: { languageCode: lang, name: voice },
              audioConfig: {
                audioEncoding: "MP3",
                speakingRate: speed,
                pitch: pitch,
                volumeGainDb: 0.0,
                sampleRateHertz: 24000,
              },
            }),
          });

          if (!res.ok) {
            if (res.status === 401 || res.status === 403) {
              showNotification(
                "Authentication failed. Check your token.",
                "error"
              );
            } else if (res.status === 429) {
              showNotification(
                "Rate limit exceeded. Try again later.",
                "error"
              );
            } else {
              showNotification(`API Error: ${res.status}`, "error");
            }
            return null;
          }

          const data = await res.json();

          if (!data.audioContent) {
            showNotification("No audio content received", "error");
            return null;
          }

          return "data:audio/mp3;base64," + data.audioContent;
        } catch (error) {
          console.error("Synthesis error:", error);
          showNotification("Network error. Check your connection.", "error");
          return null;
        }
      }

      // Play button
      document.getElementById("playBtn").addEventListener("click", async () => {
        setButtonLoading("playBtn", true);
        try {
          const src = await synthesize();
          if (src) {
            const audio = new Audio(src);
            audio.play().catch((error) => {
              console.error("Audio playback error:", error);
              showNotification("Audio playback failed", "error", 3000);
            });
            setButtonLoading("playBtn", false);
            showNotification("Playing audio", "success", 2000);
          }
        } catch (error) {
          console.error("Play error:", error);
          showNotification("Failed to play audio", "error");
        } finally {
          setButtonLoading("playBtn", false);
        }
      });

      // Download button
      document
        .getElementById("downloadBtn")
        .addEventListener("click", async () => {
          setButtonLoading("downloadBtn", true);
          try {
            const src = await synthesize();
            if (src) {
              const a = document.createElement("a");
              a.href = src;
              a.download = `tts-output-${Date.now()}.mp3`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              showNotification("Audio downloaded successfully", "success");
            }
          } catch (error) {
            console.error("Download error:", error);
            showNotification("Failed to download audio", "error");
          } finally {
            setButtonLoading("downloadBtn", false);
          }
        });
    </script>
  </body>
</html>
